{
    "contents" : "---\ntitle: \"An Analysis of Restaurant Cleanliness in New York City\"\nauthor: \"Anh Vu Nguyen, Anh Nguyen, Cody Couture\"\ndate: \"November 29, 2015\"\noutput: pdf_document\n---\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(cache=TRUE) # caching to increase knitting time when document is too big\nset.seed(2015) # set seed\nlibrary(pacman)\np_load(RSocrata,plyr,RColorBrewer,hash, mosaic, ggmap, stringr, ggplot2, Rmisc) # these are all the packages that we have used\n\n## LOAD DATASETS\nload(\"../Data/restaurantClean.Rda\") # This should be the correct path to the dataset we need\n\nrestaurant.clean <- subset(restaurant.clean, score != -1, drop = T) # remove negative scores\n\n## Get subset of dataset that we need\nchinese.restaurant <- subset((restaurant.clean), select = score, cuisine_group_factor == \"Chinese\", drop = T)\nother.restaurant <- subset((restaurant.clean), select = score, cuisine_group_factor != \"Chinese\", drop = T)\nasian.restaurant <- subset((restaurant.clean), select = score, cuisine_group_factor == \"Asian\", drop = T)\ncombined.chinese.asian <- c(asian.restaurant, chinese.restaurant)\ndf.chinese.asian <- as.data.frame(rbind(cbind(score = as.numeric(asian.restaurant), cuisine = (\"Asian\")), cbind(score = as.numeric(chinese.restaurant), cuisine = (\"Chinese\"))))\n``` \n# I. Introduction #  \nOver the past several decades, Americans spent more and more time and money at restaurants. Today, eating out consititues a significant portion of meals in the United States. On average, Americans eat from a restaurant 5.8 times a week. In fact, Americans spend more money on food in restaurants than they do on food in grocery stores. However, despite spending so much time eating out, Americans tend to spend relatively little time considering the health of their food. As the recent outbreak in Chipotle restaurants has shown, restaurants are not always safe. In fact, Chipotle, one of the leaders in food quality, have problems of its own. According to the CDC, nearly 50 million Americans will become ill this year as a result of foodborne sickness. Of those who are affected, over 100,000 will be hospitalized and approximately 3,000 will die. Given this substantial risk posed by unsanitary food preparation, it is essential that consumers have the best information possible when choosing to eat a restaurant; they need to feel comfortable that the food they are eating is safe. As a result, we have created a system of food safety inspections and accompanying safety ratings that assist restaurant goers in choosing a restaurant. Although the safety rating is far from perfect, it is a useful tool in protecting the health of American consumers.\n\nIn our study, we examine a data set of New York City food safety inspections. Due to its large population, abundance of a variety of restaurants, and a culture of eating out, New York City is an ideal candidate for observation. We are particularly interested in examining how food safety ratings vary across different types of cuisine. Certain types of cuisine, such as Chinese food or Mexican food, often have a reputation for being of a lower quality, and therefore, more dangerous to eat. If such a reputation is accurate, then consumers should adjust their behavior to account for this risk. However, if the reputation is inaccurate, then there is no reason for consumers to discriminate against these restaurants. Moreover, New York City has famously struggled with pest problems, particularly rodents. We want to determine if such a problem currently exists within New York City restaurants and, if so, determine the severity of the problem. To shed some light into the problem, below is a map of the sighted roaches and rodents in the most recent restaurant inspections. It seems rather disturbing to see so many flags popping up as sighted. \n\nUltimately, the objective of the study would be to highlight differences in food safety rating across restaurant type and location to reduce the number of illnesses caused by foodborne sickness.  \n\nSince its introduction, the NYC restaurant inspection has been scrutinized by several studies. There were studies focusing on [modeling the grades for two-year period of inspection](http://ebph.it/article/viewFile/9442/9456). There were also conflicting opinions on the trustworthy of this grading system, one by the popular iQuantNY that seems to suggest that [the grading system is flawed](http://iquantny.tumblr.com/post/76928412519/think-nyc-restaurant-grading-is-flawed-heres) and another article that suggests the author as [believer in New York City's retaurants' grades](http://fivethirtyeight.com/features/how-data-made-me-a-believer-in-new-york-citys-restaurant-grades/). However, none of the studies seems to be focusing on a specific cuisine and the problem of pests that is tied to the restaurants.  \n\n# II. Data Collection and Cleanup #  \nThe entire dataset was loaded from [NYC Open Data Portal](https://nycopendata.socrata.com/Health/DOHMH-New-York-City-Restaurant-Inspection-Results/xx67-kt59) on November 14, 2015. The raw dataset contained of 484,743 rows and was loaded into RStudio for data cleanup process.  \nThere were several considerations made while cleaning up the dataset to be use for this study:  \n\n1. **We only consider the most recent restaurant inspection**: This is because this seems to be most relevant inspection that we care about. A person eating at a place might not necessary care about an extremely bad inspection from three years ago compared to an extremely bad inspection most recently.  \n2. **We take out those inspections without a grade**: This is due to the system of grading of [The New York City Department of Health and Mental Hygiene (DOHMH)](http://www.nyc.gov/html/doh/downloads/pdf/rii/restaurant-grading-faq.pdf), where a restaurants are given two chances if they did poorly for the first inspection. Also, restaurants are only requried to post the grading from the second inspection and not the first one, which means that most pedestrians would not even be aware of the first inspection ever taking place.  \n3. **We look at whether rodents and/or roaches were sighted**: This is significant since pest has been deemed a problem in NYC by people living there. Specifically, NYC has recently escelated a [war on rats](http://www.nytimes.com/2015/06/25/nyregion/new-york-city-escalates-the-war-on-rats-once-again.html) again.  \n4. **Linking Income with Zipcode**: Since the dataset came with full address, including zipcode, we merged another dataset on income based on zipcode with our current dataset. The external dataset include Average Income, Median Income and demographic datas linked to each restaurant's specific zipcode.  \n5. **Focus on specific cuisine**: NYC is a melting pot of cultures and thus have a plethora of cuisines available. However, we choose to consider the most popular cuisines and also group certain cuisines together. Those in consideration are: \n    * American\n    * Asian [^1]\n    * Chinese\n    * Italian\n    * Latin/Spanish [^2]\n    * Pizza\n    * Sandwiches\n\n[^1]: Combination of Asian, Thai, Japanese, Korean, Vietnamese/Cambodian/Malaysia\n[^2]: Combination of Latin (Cuban, Dominican, Puerto Rican, South & Central American), Tapas, Spanish, Mexican, Caribbean\n\nAfter these processes, our dataset was shrinked down to 11,525 rows of observation. Below are the important variables that will be used in this study and a short description for each.  \n\n|Variable name |Description   |\n|-----------------|---|\n|camis   |Unique Key for each restaurant, set by DOHMH.   |\n|dba  |Name of restaurant as registered with DOHMH.   |\n|boro   |Borough that the restaurant was located in.   |\n|zipcode   |Zipcode for the address of the restaurant.   |\n|score   |Score from the last restaurant inspection.   |\n|grade   |Grade from the last restaurant inspection.   |\n|rodent_list   |Whether rodents were sighted in the last inspection (True/False)   |\n|roach_list   |Whether roaches were sighted in the last inspection (True/False)    |\n|median_income.list   |Median income associated with the Zipcode of the restaurants   |\n|cuisine_group_factor   |Cuisine for the restaurant   |\n\nThe reason why we chose to represent Chinese and all other Asian cuisine (Asian) as two separate groups is because of the number of observation for Chinese restaurants alone is very high (2,457 observations). Also, since Chinese cuisine were being associated with the negative perspective and not necesarily Thai, Korean, or Japanese food, it might be better to separate Chinese food into its own group.  \n\nIt is also important to point out that most of the restaurants falling under the Asian group are cuisines from East/Southeast Asian countries. We did not include other Asian cuisines from South Asia (such as Indian) or Middle East since the historical and cultural background of these areas set their cuisines distinctive from East/Southeast Asian cuisines.\n\t\nAfter much consideration, we have chosen to assess the restaurant's cleanliness based on the score they get from the inspection instead of the grades. This is because the grade distribution is highly skewed to A with not much B, C, and D grades. This is not a surprised based on several factors. Firstly, regarding to the distribution of score as seen below, we can see that there might be a possibility of the inspector giving the restaurants the bare grade to get an A. The drastic drop in density after score 13 shows that a restaurant rarely gets a point of 14. Also, as stated above, the inspections can be done twice for those restaurants that fail to get an A in the first inspections. The jump between a grade B and A might not be as significant as the jump from a 29 points to 0 points. \n\n```{r}\nfavstats(~restaurant.clean$score)\n```\nThe score ranges from 0 to 80, with a mean of 11. Since the third quantile gets a value of 12, at least 75% of our restaurants score an 'A' in the inspection. \n\n```{r ditributionOfScore}\ndensityplot(~score, group = cuisine_group_factor, \n            data = restaurant.clean, auto.key = TRUE, xlim = c(0,20),\n            panel=function(x,...){\n              panel.densityplot(x,...)\n              median.values <- median(x) \n              panel.abline(v=13,col=4,lty=2)\n            },\n            xlab = \"Score\", main = \"Density Plot for Score Among Different Groups\")\n```\n\n# III. Are Chinese Restaurants the Worst? ##  \n## 1. Are Chinese Restaurants Worse Than Other Restaurants? ##  \nWe tackled this question by first running a t-test to find the 95% confident interval for the mean score of Chinese restaurants. \n```{r confidentIntervalChineseOther}\nt.test(chinese.restaurant, conf.level = 0.95)$conf\n```\nFrom the statistics above, we are 95% confident that the mean score of Chinese restaurants will be between 11 and 11.5, equivalent to scoring an ‘A’ in the inspection. \n\nNext, in order to get a sense of how clean Chinese restaurants are in comparison with other restaurants, we did a permutation test, with mean score as the test statistics. However, since we also want a robust statistics, which are not sensitive to outliers, we also did a permutation test with trimmed mean. The trimmed mean omit a certain fraction of the low and high values, and calculate the remaining values. Our assumption, or alternative hypothesis, for this test was Chinese restaurants would have a higher average score, meaning they are not as clean as other restaurants area.\n$$\nH_o: \\mu_{Chinese} = \\mu_{Asian}\n$$\n$$\nH_a: \\mu_{Chinese} > \\mu_{Asian}\n$$ \n\n```{r permTestMeanChineseOther}\nN <- 10^4-1\nm <- length(chinese.restaurant)\ntotal <- length(chinese.restaurant) + length(other.restaurant)\n\nmeanDiff <- numeric(N)\ntrmeanDiff <- numeric(N)\n\nfor(i in 1 : N)\n{\n  index <- sample(total, m, replace = FALSE)\n  meanDiff[i] <- mean((restaurant.clean$score[index])) - \n    mean((restaurant.clean$score[-index]))\n  trmeanDiff[i] <- mean((restaurant.clean$score[index]), trim = 0.25) - \n    mean((restaurant.clean$score[-index]), trim = 0.25)\n}\n\n#mean\nobserved.mean.diff <- mean(chinese.restaurant) - mean(other.restaurant)\n\nhistogram(meanDiff, \n          xlab = \"Chinese Avg Score - Other Avg Score\", \n          main=\"Perm. Test b/w Chinese & Other cuisine\", \n          v = observed.mean.diff)\n(sum(meanDiff > observed.mean.diff) +1) / (N+1) # p-val\n```\nWe got a p-value of 0.0069, which is significantly smaller than 0.05, suggesting strong evidence to reject the null hypothesis. We concluded that Chinese restaurants might not be as clean as other restaurants do.  \n\n```{r}\n#trimmed mean\nobserved.trmean.diff <- mean(chinese.restaurant, trim = 0.25) - \n  mean(other.restaurant, trim = 0.25)\n\nhistogram(trmeanDiff, \n          xlab = \"Chinese Trimmed Median Score - Other Trimmed Median Score\",\n          main=\"Perm. Test b/w Chinese & Other cuisine\", \n          v = observed.trmean.diff)\n(sum(trmeanDiff > observed.trmean.diff) +1) / (N+1) # p-val\n```  \nFor the trimmed mean permutation test, we get a p-value of 0.0868, which is higher than 0.05. We concluded that when we removed some Chinese restaurants with extreme scores, the difference in mean score is not as extreme anymore. Chinese restaurants might not be as clean as others, yet, this might happen due to the fact that there exists some Chinese restaurants with extremely high scores.  \n\n## 2. Is There a Cuisine Worse than Chinese Cuisine? ##  \nAfter establishing that Chinese food might not be as clean as other cuisine, we now attempt to answer the question of whether its stereotypical title of being \"dirties\" is deserving. We pick Asian food, another cuisine with high mean score average (11.61) and test to see whether its score might be better or worse than that of Chinese cuisine.  \nWe started by calculating the confident interval at 95% confidence for the difference in mean score between Chinese and Asian restaurants.\n```{r confidentIntervalChineseAsian}\nt.test(chinese.restaurant, asian.restaurant)$conf\n```  \nThe interval above passes through zero, giving us no strong evidence of difference in mean score right now. Therefore, we proceed to a permutation test for the difference in mean score between Chinese and Asian restaurants, followed by the same test with the trimmed mean score.    \nLet $\\mu_{Chinese}$ and $\\mu_{Asian}$ be the mean score of Chinese and Asian restaurants respectively. We have the following hypothesis:\n$$\nH_o: \\mu_{Chinese} = \\mu_{Asian}\n$$\n$$\nH_a: \\mu_{Chinese} > \\mu_{Asian}\n$$  \n```{r permTestMeanChineseAsian}\nobserved.mean.diff <- mean(chinese.restaurant) - mean(asian.restaurant)\n\nm <- length(chinese.restaurant)\ntotal <- length(chinese.restaurant) + length(asian.restaurant)\n\nmeanDiff <- numeric(N)\n\nfor(i in 1 : N)\n{\n  index <- sample(total, m, replace = FALSE)\n  meanDiff[i] <- \n    mean((combined.chinese.asian[index])) - mean((combined.chinese.asian[-index]))\n}\n\nhistogram(meanDiff, xlab = \"Chinese Avg Score - Asian Avg Score\", \n          main = \"Diff. in Mean Score b/w Chinese and Asian Restaurants\", \n          v = observed.mean.diff)\n(sum(meanDiff > observed.mean.diff) +1) / (N+1)\n```  \nWe see that p-value is 0.94, which is higher than the $\\alpha$ value of 0.05. Therefore, we fail to reject the alternative hypothesis that Chinese cuisine scores on average higher than that of Asian cuisine.\n```{r permTestTrimmedMeanChineseAsian}\nobserved.trmean.score.diff <- mean(chinese.restaurant, trim = 0.25) - mean(asian.restaurant, trim = 0.25)\n\ntrmeanDiff <- numeric(N)\n\nfor(i in 1 : N)\n{\n  index <- sample(total, m, replace = FALSE)\n  trmeanDiff[i] <- \n    mean((combined.chinese.asian[index]), trim = 0.25) -\n    mean((combined.chinese.asian[-index]), trim = 0.25)\n}\n\nhistogram(trmeanDiff, xlab = \"Chinese Trimmed Mean Score - Asian Trimmed Mean Score\", \n          main = \"Diff. in Trimmed Mean Score b/w Chinese and Asian Restaurants\", \n          v = observed.trmean.score.diff)\n(sum(trmeanDiff > observed.trmean.score.diff) +1) / (N+1)\n```\nAgain, we see a high p-value of 0.99. Therefore, we fail to reject the alternative hypothesis that Chinese cuisine scores on average higher than that of Asian cuisine.  \nTherefore, in both cases, we have failed to reject the null hypothesis, suggesting that Chinese cuisine might not be the dirtiest but might actually be the same as other Asian countries cuisines.  \nIt is also interesting to note the difference between the mean and trimmed mean p-value. The p-value for trimmed mean is higher than that for mean. This means that the difference in observed statistics are more outside the range of normal chance variation for trimmed mean than for mean. Therefore, it might suggest that Chinese restaurants' score might be driven by some really high scoring restaurants while Asian restaurants' score is just in general higher than Chinese's, with not as many outliers that being as extreme as Chinese's.  \nWe confirm this with the density plot below:\n```{r}\ndensityplot(~ score, group = cuisine, data = df.chinese.asian,\n            main = \"Densityplot for score of Chinese and Asian food.\",\n            xlab = \"Score\", auto.key = TRUE)\n```\n  \nAs we can see, Asian cuisince has a lower density of outliers with score of above 40. This means that it does not have as many outliers on that end. However, for the peak close to 10, we can see that there is higher concentration of Asian cuisine. The peak of Chinese food is slightly to the left of that for Asian food. This could be an exaplanation for the differences in mean and trimmed mean's p-values.  \n\n## 3. Regression Modeling ##  \n```{r plotForAllCuisine}\nxyplot(sqrt(score)~median_income.list | cuisine_group_factor, data = restaurant.clean)\n```  \n  \n### a. Simple Linear Model ###  \nThe model linking score and income.\n\n#### Assumptions ####    \nAre assumptions for this model met?\n- \n- normal distribution of residuals\n\n### b. Multivariable Linear Model ###   \nThe model linking score with cuisine + income.\n\n#### Assumptions ####  \nAre assumptions for this model met?\n\n### c. Model Intepretation ###   \nWe see that income is linked with cuisine, which is linked with score.  \n\n# IV. The Pest Problem in NYC #\nHistorically, it has not been uncommon for restaurants to have pests such as rodents and roaches. We run bootstrap tests in an attempt to determine the true percentage of restaurants with rodents or roaches during their most recent inspection.\n\n## How common are rodents in NYC ##  \n```{r}\nrodent_list <- subset((restaurant.clean), select = rodent_list, drop = T)\nboot.rodent <- numeric(N)\nfor(i in 1 : N)\n{\n  rodent <- sample(rodent_list, length(rodent_list), replace = T)\n  boot.rodent[i] <- mean(rodent) # TRUE / (TRUE + FALSE)\n}\nhistogram(boot.rodent, v = mean(boot.rodent), \n          main = \"Bootstrap distribution of rodent\", \n          xlab = \"Percent TRUE for rodent\")\nmean(boot.rodent)\nsd(boot.rodent)\nqqnorm(boot.rodent)\nqqline(boot.rodent)\n```\n\nThe bootstrap suggests that the true percentage of restaurants in New York City in which inspections found rodents is between 10% and 11.5%, with the most likely guess being 10.7%.\n\n## How common are roaches in NYC ## \n```{r}\nroach_list <- subset((restaurant.clean), select = roach_list, drop = T)\nboot.roach <- numeric(N)\nfor(i in 1 : N)\n{\n  roach <- sample(roach_list, length(roach_list), replace = T)\n  boot.roach[i] <- mean(roach) # TRUE / (TRUE + FALSE)\n}\nhistogram(boot.roach, v = mean(boot.roach), \n          main = \"Bootstrap distribution of roach\", \n          xlab = \"Percent TRUE for roach\")\nmean(boot.roach)\nsd(boot.roach)\nqqnorm(boot.roach)\nqqline(boot.roach)\n```\n\nThe bootstrap suggests that the true percentage of restaurants in New York City in which inspections found roaches is between 2% and 4%, with the most likely guess being 2.8%.\n\n## Rodents and Income ##  \n```{r}\ndensityplot( ~ log(median_income.list), groups=rodent_list, data=restaurant.clean, \n             main=\"Roaches and Income\")\n```\n\nThe income of the zip code that the restaurants are in does not seem to vary based upon whether rodents were found during the last inspection. This suggests that the presence of rodents in a restaurant is not dependent upon income. In other words, restaurants in wealthier areas are just as likely to have rodents as restaurants in poorer areas of the city. \n\n## Roaches and Income ##  \n```{r}\ndensityplot( ~ log(median_income.list), groups=roach_list, data=restaurant.clean, \n             main=\"Roaches and Income\")\n```\n\nThe income of the zip code that the restaurants are in appears  to vary based upon whether roaches were found during the last inspection. This suggests that the presence of roaches in a restaurant is dependent upon the income of that zip code. In other words, restaurants in wealthier areas are less likely to have roaches than restaurants in poorer areas of the city. \n\n# V. Sources of improvements/Notes #  \nWhile the results of this study are interesting, there a several notes that should be made. First, the data on restaurants comes entirely from New York City. While many of these results may apply to other cities, New York City is unique and as such, it is difficult to generalize. Secondly, our results are contigent to a certain extent on the accuracy of the restaurant inspections. If these inspections are biased against particular cuisines or geographic locations, obviously the results of this paper may also be inaccurate. Thirdly, we only considered a handful of cuisines and the categorization was somewhat arbitrary. It is possible that other, less popular cuisines are actually significantly worse than those included in this paper. Similarly, a different categorization may yield different results. A more thorough analysis of the subject could shed light on such details. \n\n# VI. Potentials for Future Projects #  \nThere are several potential continuation to this project. Firstly, it is interesting to see roaches being correlated to income. This brings up the question of whether income disparity could be linked with presence of roaches. Currently, there have been studies between [housing disrepair condition and pest infestation](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC1314924/). From the public health standpoint, [cockroaches allergens have been studied for association with prevalence of childhood asthma](http://www.sciencedaily.com/releases/2011/05/110517151301.htm) and thus knowing the above relationship could help answer more public health questions. \n\n# VII. Conclusion #  \nIn this paper we used restaurant inspection scores in New York City to answer two questions: Are Chinese restaurants less sanitary than restaurants of other cuisines and how bad is the pest problem in New York City? We found that while Chinese restaurants are worse than the average restaurant in New York City, Chinese restaurants are not the worst. In fact, Asian restaurants (Latin??) performed worse than Chinese restaurants. Furthermore, we found that rodents and roaches are a significant problem in New York City Restaurants, being found in 10% and 3% of restaurants respectively. Interestingly, while roaches are more likely to be found in lower income zip codes, the presence of roaches does not appear to vary based upon a region's income.\n\n",
    "created" : 1450127361155.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3701151578",
    "id" : "35A61C8F",
    "lastKnownWriteTime" : 1450134602,
    "path" : "~/Dropbox/F15/MA371/Stats Project/RestaurantInspection/Report/Report.Rmd",
    "project_path" : "Report/Report.Rmd",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_markdown"
}